<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor Lifting Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-alt: #020617;
      --card: #1e293b;
      --card-alt: #0b1120;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-strong: #4ade80;
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                  "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #1f2937 0, #020617 60%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .app-container {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, var(--bg), var(--bg-alt));
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow:
        0 30px 80px rgba(15, 23, 42, 0.8),
        0 0 0 1px rgba(15, 23, 42, 0.6);
      padding: 18px 18px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 900px) {
      .app-container {
        padding: 20px 24px 26px;
      }
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-title h1 {
      font-size: 1.15rem;
      margin: 0;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .badge {
      font-size: 0.7rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
    }

    .tag-pill {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.09);
      color: var(--accent-strong);
      border: 1px solid rgba(34, 197, 94, 0.35);
    }

    .top-tabs {
      display: inline-flex;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      padding: 3px;
      border: 1px solid rgba(30, 64, 175, 0.3);
    }

    .top-tab {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.78rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }

    .top-tab.active {
      background: radial-gradient(circle at 30% 0, #22c55e 0, #15803d 60%);
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.3);
    }

    .top-tab:not(.active):hover {
      color: #e5e7eb;
    }

    .layout {
      display: flex;
      gap: 16px;
      flex: 1;
      min-height: 0;
      flex-direction: column;
    }

    @media (min-width: 900px) {
      .layout {
        flex-direction: row;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, #020617 0, #020617 40%);
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 12px 12px 14px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow:
        inset 0 1px 0 rgba(148, 163, 184, 0.08),
        0 15px 30px rgba(15, 23, 42, 0.9);
    }

    @media (min-width: 900px) {
      .panel-left {
        flex: 1.2;
      }
      .panel-right {
        flex: 1;
      }
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .panel-header h2 {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 0;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .subtext {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin: 0;
    }

    .day-tabs {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.85);
      border-radius: 999px;
      padding: 3px;
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .day-tab {
      border-radius: 999px;
      padding: 4px 12px;
      font-size: 0.78rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }

    .day-tab.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.45);
    }

    .day-tab:not(.active):hover {
      color: #e5e7eb;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-top: 2px;
    }

    .pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--text-muted);
    }

    .exercise-list {
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(31, 41, 55, 1);
      padding: 8px;
      margin-top: 2px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
    }

    .exercise-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 7px;
      border-radius: 8px;
      background: radial-gradient(circle at 0 0, #111827 0, #020617 60%);
      border: 1px solid rgba(55, 65, 81, 0.85);
    }

    .exercise-row span.label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      min-width: 50px;
    }

    .exercise-input {
      flex: 1;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 6px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      padding: 4px 8px;
      font-size: 0.85rem;
      color: var(--text-main);
    }

    .exercise-input:focus {
      outline: none;
      border-color: rgba(34, 197, 94, 0.8);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
    }

    .tiny-tag {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--text-muted);
    }

    .actions-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      transition: all 0.15s ease-out;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #f9fafb;
      box-shadow:
        0 10px 25px rgba(22, 163, 74, 0.45),
        0 0 0 1px rgba(22, 163, 74, 0.6);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow:
        0 14px 30px rgba(22, 163, 74, 0.55),
        0 0 0 1px rgba(22, 163, 74, 0.9);
    }

    .btn-outline {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .btn-outline:hover {
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.8);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: none;
      padding: 0;
    }

    .btn-ghost:hover {
      color: #e5e7eb;
    }

    .session-card {
      border-radius: 12px;
      background: radial-gradient(circle at top left, #020617 0, #020617 55%);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 8px 9px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .session-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .session-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .session-title h3 {
      margin: 0;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #d1d5db;
    }

    .session-title span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .session-body {
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      padding: 6px 7px 7px;
      max-height: 260px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .session-exercise {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      padding: 5px 6px;
      background: radial-gradient(circle at 0 0, #111827 0, #020617 55%);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .session-ex-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .session-ex-name {
      flex: 1;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .session-ex-name-input {
      flex: 1;
      background: transparent;
      border: none;
      font-size: 0.85rem;
      color: var(--text-main);
      padding: 2px 4px;
      border-bottom: 1px dashed rgba(75, 85, 99, 0.9);
    }

    .session-ex-name-input:focus {
      outline: none;
      border-bottom-color: rgba(34, 197, 94, 0.9);
    }

    .sets-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 3px;
    }

    .sets-table th,
    .sets-table td {
      font-size: 0.73rem;
      text-align: center;
      padding: 3px 2px;
      color: var(--text-muted);
    }

    .sets-table th {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 500;
      border-bottom: 1px solid rgba(55, 65, 81, 0.95);
    }

    .sets-table input {
      width: 100%;
      font-size: 0.75rem;
      text-align: center;
      padding: 2px 3px;
      border-radius: 4px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
    }

    .sets-table input:focus {
      outline: none;
      border-color: rgba(34, 197, 94, 0.8);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    .calendar-container {
      border-radius: 12px;
      background: radial-gradient(circle at top right, #020617 0, #020617 55%);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 8px 9px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .calendar-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .calendar-title h3 {
      margin: 0;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #d1d5db;
    }

    .calendar-title span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .calendar-nav {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .calendar-nav button {
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.78rem;
      padding: 4px 10px;
      cursor: pointer;
    }

    .calendar-nav button:hover {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
    }

    .calendar-grid {
      margin-top: 4px;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
      padding: 6px;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      font-size: 0.75rem;
    }

    .calendar-day-header {
      text-align: center;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
      padding-bottom: 2px;
    }

    .calendar-cell {
      min-height: 40px;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, #020617 0, #020617 70%);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 3px 4px;
      cursor: default;
      transition: all 0.1s ease-out;
      position: relative;
    }

    .calendar-cell.empty {
      visibility: hidden;
    }

    .calendar-day-number {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .calendar-cell.gym-day {
      border-color: rgba(34, 197, 94, 0.9);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      background: radial-gradient(circle at top, rgba(34, 197, 94, 0.18) 0, #020617 80%);
    }

    .calendar-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      position: absolute;
      bottom: 4px;
      right: 4px;
    }

    .calendar-cell.selected {
      border-color: rgba(59, 130, 246, 0.9);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.6);
    }

    .calendar-details {
      margin-top: 4px;
      font-size: 0.75rem;
      color: var(--text-muted);
      max-height: 132px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 6px;
      background: rgba(15, 23, 42, 0.9);
    }

    .calendar-details h4 {
      margin: 0 0 4px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .calendar-entry {
      margin-bottom: 4px;
      padding-bottom: 3px;
      border-bottom: 1px dashed rgba(55, 65, 81, 0.7);
    }

    .calendar-entry:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .calendar-entry-title {
      font-size: 0.76rem;
      color: #e5e7eb;
    }

    .calendar-entry-meta {
      font-size: 0.73rem;
      color: var(--text-muted);
    }

    .date-input {
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      padding: 4px 10px;
      font-size: 0.78rem;
    }

    .date-input:focus {
      outline: none;
      border-color: rgba(34, 197, 94, 0.8);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
    }

    .empty-state {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 8px;
      border-radius: 8px;
      border: 1px dashed rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .footer-note {
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: flex-end;
      margin-top: -4px;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(55, 65, 81, 0.85);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(75, 85, 99, 1);
    }
  </style>
</head>
<body>
  <div id="root" class="app-shell"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script>
    const { useState, useEffect } = React;

    const STORAGE_KEY_TEMPLATES = "doctor_lift_templates_v1";
    const STORAGE_KEY_SESSIONS = "doctor_lift_sessions_v1";

    const defaultTemplates = {
      day1: {
        id: "day1",
        name: "Day 1 – Delts & Triceps",
        note: "Overhead press, delts, big triceps & abs.",
        exercises: [
          "Overhead Press",
          "Dumbbell Lateral Raise",
          "Cable Lateral Raise",
          "Close-Grip Bench Press / Dips",
          "Cable Triceps Pushdown",
          "Overhead Triceps Extension",
          "Abs – Hanging Leg Raise",
          "Abs – Plank"
        ]
      },
      day2: {
        id: "day2",
        name: "Day 2 – Back, Biceps & Traps",
        note: "Pulling, biceps focus & traps with abs.",
        exercises: [
          "Pull-Ups / Lat Pulldown",
          "Chest-Supported Row / Seated Row",
          "Barbell / Dumbbell Shrug",
          "EZ Bar Curl",
          "Incline Dumbbell Curl",
          "Hammer Curl",
          "Abs – Cable Crunch",
          "Abs – Reverse Crunch"
        ]
      },
      priority: {
        id: "priority",
        name: "Priority Session",
        note: "Everything you care about when time is tight.",
        exercises: [
          "Overhead Press",
          "Pull-Ups / Lat Pulldown",
          "Close-Grip Bench / Dips",
          "Dumbbell Lateral Raise",
          "Barbell / Dumbbell Shrug",
          "EZ Bar Curl",
          "Cable Triceps Pushdown",
          "Abs Circuit"
        ]
      }
    };

    function getTodayISO() {
      const d = new Date();
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function loadFromStorage(key, fallback) {
      try {
        const raw = window.localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch (e) {
        console.error("Failed to parse storage for", key, e);
        return fallback;
      }
    }

    function saveToStorage(key, value) {
      try {
        window.localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.error("Failed to save storage for", key, e);
      }
    }

    function App() {
      const [templates, setTemplates] = useState(() =>
        loadFromStorage(STORAGE_KEY_TEMPLATES, defaultTemplates)
      );
      const [sessions, setSessions] = useState(() =>
        loadFromStorage(STORAGE_KEY_SESSIONS, [])
      );
      const [selectedDayKey, setSelectedDayKey] = useState("day1");
      const [activeSession, setActiveSession] = useState(null);
      const [activeTab, setActiveTab] = useState("workout");
      const [calendarMonth, setCalendarMonth] = useState(() => {
        const d = new Date();
        return { year: d.getFullYear(), month: d.getMonth() }; // 0-indexed
      });
      const [selectedDate, setSelectedDate] = useState(getTodayISO());

      useEffect(() => {
        saveToStorage(STORAGE_KEY_TEMPLATES, templates);
      }, [templates]);

      useEffect(() => {
        saveToStorage(STORAGE_KEY_SESSIONS, sessions);
      }, [sessions]);

      const currentTemplate = templates[selectedDayKey];

      function handleTemplateExerciseChange(index, newName) {
        setTemplates(prev => {
          const copy = { ...prev };
          const t = { ...copy[selectedDayKey] };
          const ex = [...t.exercises];
          ex[index] = newName;
          t.exercises = ex;
          copy[selectedDayKey] = t;
          return copy;
        });
      }

      function handleStartSession() {
        if (!currentTemplate) return;
        const session = {
          id: `${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,
          date: getTodayISO(),
          templateId: currentTemplate.id,
          templateName: currentTemplate.name,
          dayKey: selectedDayKey,
          exercises: currentTemplate.exercises.map(name => ({
            name,
            sets: []
          }))
        };
        setActiveSession(session);
        setActiveTab("workout");
      }

      function handleSessionDateChange(newDate) {
        setActiveSession(prev => prev ? { ...prev, date: newDate } : prev);
      }

      function handleSessionExerciseNameChange(exIndex, newName) {
        setActiveSession(prev => {
          if (!prev) return prev;
          const exs = prev.exercises.map((ex, i) =>
            i === exIndex ? { ...ex, name: newName } : ex
          );
          return { ...prev, exercises: exs };
        });
      }

      function handleAddSet(exIndex) {
        setActiveSession(prev => {
          if (!prev) return prev;
          const exs = prev.exercises.map((ex, i) => {
            if (i !== exIndex) return ex;
            const newSets = [
              ...ex.sets,
              { weight: "", reps: "", rest: "" }
            ];
            return { ...ex, sets: newSets };
          });
          return { ...prev, exercises: exs };
        });
      }

      function handleSetFieldChange(exIndex, setIndex, field, value) {
        setActiveSession(prev => {
          if (!prev) return prev;
          const exs = prev.exercises.map((ex, i) => {
            if (i !== exIndex) return ex;
            const sets = ex.sets.map((set, sIndex) =>
              sIndex === setIndex ? { ...set, [field]: value } : set
            );
            return { ...ex, sets };
          });
          return { ...prev, exercises: exs };
        });
      }

      function handleSaveSession() {
        if (!activeSession) return;
        const cleaned = {
          ...activeSession,
          exercises: activeSession.exercises.map(ex => ({
            ...ex,
            sets: ex.sets.filter(
              s => s.weight || s.reps || s.rest
            )
          }))
        };
        setSessions(prev => [...prev, cleaned]);
        setSelectedDate(cleaned.date);
        setActiveSession(null);
        setActiveTab("calendar");
      }

      function handleCancelSession() {
        setActiveSession(null);
      }

      function goMonth(delta) {
        setCalendarMonth(prev => {
          const newMonth = prev.month + delta;
          const newDate = new Date(prev.year, newMonth, 1);
          return { year: newDate.getFullYear(), month: newDate.getMonth() };
        });
      }

      const daysOfWeek = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

      function buildCalendar(year, month) {
        const startDate = new Date(year, month, 1);
        const startDay = (startDate.getDay() + 6) % 7; // convert Sun=0 to end
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const cells = [];

        for (let i = 0; i < startDay; i++) {
          cells.push(null);
        }
        for (let day = 1; day <= daysInMonth; day++) {
          cells.push(day);
        }
        return cells;
      }

      const calendarCells = buildCalendar(calendarMonth.year, calendarMonth.month);

      function formatMonthTitle(year, month) {
        const d = new Date(year, month, 1);
        const monthName = d.toLocaleString("default", {
          month: "long"
        });
        return `${monthName} ${year}`;
      }

      function isoFromParts(year, month, day) {
        const m = String(month + 1).padStart(2, "0");
        const d = String(day).padStart(2, "0");
        return `${year}-${m}-${d}`;
      }

      function sessionsForDate(iso) {
        return sessions.filter(s => s.date === iso);
      }

      const selectedSessions = selectedDate ? sessionsForDate(selectedDate) : [];

      const trainingDaysCountInMonth = sessions.reduce((acc, s) => {
        const [y, m] = s.date.split("-").map(Number);
        if (y === calendarMonth.year && m === calendarMonth.month + 1) {
          acc.add(s.date);
        }
        return acc;
      }, new Set());

      const trainingDaysCount = trainingDaysCountInMonth.size;

      const trainingDaysWeek = sessions.reduce((acc, s) => {
        const date = new Date(s.date);
        const now = new Date();
        const diffDays = (now - date) / 86400000;
        if (diffDays >= 0 && diffDays < 7) {
          acc.add(s.date);
        }
        return acc;
      }, new Set()).size;

      return (
        <div className="app-container">
          <header className="app-header">
            <div className="app-title">
              <span className="tag-pill">Cut Phase • Arm & Delts Emphasis</span>
              <h1>Doctor Lifting Log</h1>
              <span className="badge">Local &nbsp;•&nbsp; No signup, everything stays on this device</span>
            </div>
            <div className="top-tabs">
              <button
                className={"top-tab " + (activeTab === "workout" ? "active" : "")}
                onClick={() => setActiveTab("workout")}
              >
                Workout
              </button>
              <button
                className={"top-tab " + (activeTab === "calendar" ? "active" : "")}
                onClick={() => setActiveTab("calendar")}
              >
                Calendar
              </button>
            </div>
          </header>

          <main className="layout">
            {activeTab === "workout" && (
              <>
                <section className="panel panel-left">
                  <div className="panel-header">
                    <div>
                      <h2>Templates</h2>
                      <p className="subtext">
                        Day 1, Day 2 &amp; Priority – edit exercise names freely.
                      </p>
                    </div>
                    <div className="day-tabs">
                      <button
                        className={"day-tab " + (selectedDayKey === "day1" ? "active" : "")}
                        onClick={() => setSelectedDayKey("day1")}
                      >
                        Day 1
                      </button>
                      <button
                        className={"day-tab " + (selectedDayKey === "day2" ? "active" : "")}
                        onClick={() => setSelectedDayKey("day2")}
                      >
                        Day 2
                      </button>
                      <button
                        className={"day-tab " + (selectedDayKey === "priority" ? "active" : "")}
                        onClick={() => setSelectedDayKey("priority")}
                      >
                        Priority
                      </button>
                    </div>
                  </div>

                  {currentTemplate ? (
                    <>
                      <div className="pill-row">
                        <span className="pill">{currentTemplate.name}</span>
                        <span className="tiny-tag">{currentTemplate.note}</span>
                      </div>

                      <div className="exercise-list">
                        {currentTemplate.exercises.map((name, idx) => (
                          <div key={idx} className="exercise-row">
                            <span className="label">
                              #{idx + 1}
                            </span>
                            <input
                              className="exercise-input"
                              value={name}
                              onChange={e =>
                                handleTemplateExerciseChange(idx, e.target.value)
                              }
                            />
                          </div>
                        ))}
                        {currentTemplate.exercises.length === 0 && (
                          <div className="empty-state">
                            No exercises yet. Add some by typing names above.
                          </div>
                        )}
                      </div>

                      <div className="actions-row">
                        <button className="btn btn-primary" onClick={handleStartSession}>
                          <span>Start Session from this Day</span>
                        </button>
                        <span className="subtext">
                          You&apos;ll be able to log weight, reps &amp; rest for each set.
                        </span>
                      </div>
                    </>
                  ) : (
                    <div className="empty-state">
                      No template selected. Pick Day 1, Day 2 or Priority.
                    </div>
                  )}

                  <div className="footer-note">
                    Tip: tweak exercise names over time as your preferences evolve.
                  </div>
                </section>

                <section className="panel panel-right">
                  <div className="panel-header">
                    <div>
                      <h2>Active Session</h2>
                      <p className="subtext">
                        Log today&apos;s work: weight, reps &amp; rest per set. Save to lock it in.
                      </p>
                    </div>
                    {activeSession && (
                      <div className="pill-row">
                        <span className="chip">
                          <span className="chip-dot" /> {activeSession.templateName}
                        </span>
                      </div>
                    )}
                  </div>

                  {activeSession ? (
                    <div className="session-card">
                      <div className="session-header">
                        <div className="session-title">
                          <h3>Today&apos;s Session</h3>
                          <span>
                            From: {activeSession.templateName} ·{" "}
                            {activeSession.dayKey === "priority"
                              ? "Priority"
                              : activeSession.dayKey === "day1"
                              ? "Day 1"
                              : "Day 2"}
                          </span>
                        </div>
                        <div>
                          <input
                            type="date"
                            className="date-input"
                            value={activeSession.date}
                            onChange={e => handleSessionDateChange(e.target.value)}
                          />
                        </div>
                      </div>

                      <div className="session-body">
                        {activeSession.exercises.map((ex, exIndex) => (
                          <div key={exIndex} className="session-exercise">
                            <div className="session-ex-header">
                              <input
                                className="session-ex-name-input"
                                value={ex.name}
                                onChange={e =>
                                  handleSessionExerciseNameChange(
                                    exIndex,
                                    e.target.value
                                  )
                                }
                              />
                              <button
                                className="btn btn-outline"
                                onClick={() => handleAddSet(exIndex)}
                              >
                                + Set
                              </button>
                            </div>
                            {ex.sets.length > 0 ? (
                              <table className="sets-table">
                                <thead>
                                  <tr>
                                    <th>Set</th>
                                    <th>Weight</th>
                                    <th>Reps</th>
                                    <th>Rest (s)</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {ex.sets.map((set, setIndex) => (
                                    <tr key={setIndex}>
                                      <td>{setIndex + 1}</td>
                                      <td>
                                        <input
                                          value={set.weight}
                                          onChange={e =>
                                            handleSetFieldChange(
                                              exIndex,
                                              setIndex,
                                              "weight",
                                              e.target.value
                                            )
                                          }
                                          placeholder="kg"
                                        />
                                      </td>
                                      <td>
                                        <input
                                          value={set.reps}
                                          onChange={e =>
                                            handleSetFieldChange(
                                              exIndex,
                                              setIndex,
                                              "reps",
                                              e.target.value
                                            )
                                          }
                                          placeholder="reps"
                                        />
                                      </td>
                                      <td>
                                        <input
                                          value={set.rest}
                                          onChange={e =>
                                            handleSetFieldChange(
                                              exIndex,
                                              setIndex,
                                              "rest",
                                              e.target.value
                                            )
                                          }
                                          placeholder="secs"
                                        />
                                      </td>
                                    </tr>
                                  ))}
                                </tbody>
                              </table>
                            ) : (
                              <span className="subtext">
                                No sets yet – hit &ldquo;+ Set&rdquo; to add your first one.
                              </span>
                            )}
                          </div>
                        ))}
                      </div>

                      <div className="actions-row">
                        <button className="btn btn-primary" onClick={handleSaveSession}>
                          Save Session &amp; Log Day
                        </button>
                        <button className="btn btn-outline" onClick={handleCancelSession}>
                          Cancel
                        </button>
                      </div>
                    </div>
                  ) : (
                    <div className="empty-state">
                      No active session. Start one from a template on the left.  
                      This card will show today&apos;s exercises, sets and rest when a
                      session is active.
                    </div>
                  )}
                </section>
              </>
            )}

            {activeTab === "calendar" && (
              <>
                <section className="panel panel-left">
                  <div className="calendar-container">
                    <div className="calendar-header">
                      <div className="calendar-title">
                        <h3>Training Calendar</h3>
                        <span>
                          Green days = gym sessions logged. This month:{" "}
                          {trainingDaysCount} training day
                          {trainingDaysCount === 1 ? "" : "s"} ·
                          Last 7 days: {trainingDaysWeek}
                        </span>
                      </div>
                      <div className="calendar-nav">
                        <button onClick={() => goMonth(-1)}>←</button>
                        <button disabled>
                          {formatMonthTitle(calendarMonth.year, calendarMonth.month)}
                        </button>
                        <button onClick={() => goMonth(1)}>→</button>
                      </div>
                    </div>
                    <div className="calendar-grid">
                      {daysOfWeek.map(d => (
                        <div key={d} className="calendar-day-header">
                          {d}
                        </div>
                      ))}
                      {calendarCells.map((day, idx) => {
                        if (day === null) {
                          return <div key={idx} className="calendar-cell empty" />;
                        }
                        const iso = isoFromParts(
                          calendarMonth.year,
                          calendarMonth.month,
                          day
                        );
                        const hasSession = sessionsForDate(iso).length > 0;
                        const isSelected = iso === selectedDate;
                        return (
                          <div
                            key={idx}
                            className={
                              "calendar-cell" +
                              (hasSession ? " gym-day" : "") +
                              (isSelected ? " selected" : "")
                            }
                            onClick={() => setSelectedDate(iso)}
                          >
                            <span className="calendar-day-number">{day}</span>
                            {hasSession && <div className="calendar-dot" />}
                          </div>
                        );
                      })}
                    </div>
                    <div className="footer-note">
                      Tip: click a green day to review what you did.
                    </div>
                  </div>
                </section>

                <section className="panel panel-right">
                  <div className="panel-header">
                    <div>
                      <h2>Day Details</h2>
                      <p className="subtext">
                        Review sessions logged on the selected day.
                      </p>
                    </div>
                    <div>
                      <input
                        type="date"
                        className="date-input"
                        value={selectedDate}
                        onChange={e => setSelectedDate(e.target.value)}
                      />
                    </div>
                  </div>
                  {selectedSessions.length > 0 ? (
                    <div className="calendar-details">
                      <h4>
                        {selectedSessions.length} session
                        {selectedSessions.length === 1 ? "" : "s"} on {selectedDate}
                      </h4>
                      {selectedSessions.map((s, idx) => (
                        <div key={s.id} className="calendar-entry">
                          <div className="calendar-entry-title">
                            #{idx + 1} &middot; {s.templateName}
                          </div>
                          <div className="calendar-entry-meta">
                            Exercises logged:{" "}
                            {s.exercises.filter(ex => ex.sets && ex.sets.length > 0).length}{" "}
                            · Total sets:{" "}
                            {s.exercises.reduce(
                              (sum, ex) => sum + (ex.sets ? ex.sets.length : 0),
                              0
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="empty-state">
                      No sessions logged on this date yet. Click a green day in the
                      calendar, or switch back to Workout and log today&apos;s session.
                    </div>
                  )}
                </section>
              </>
            )}
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>